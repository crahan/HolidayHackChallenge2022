---
icon: material/shark-fin
---

# Wireshark Practice

**Difficulty**: :fontawesome-solid-star::fontawesome-regular-star::fontawesome-regular-star::fontawesome-regular-star::fontawesome-regular-star:<br/>
**Direct link**: [wireshark terminal](https://hhc22-wetty.kringlecon.com/?&challenge=wireshark&id=71b0b8c5-e089-4281-95d7-dfe14c59e7c7)


## Objective

!!! question "Request"
    Use the Wireshark Phishing terminal in the Tolkien Ring to solve the mysteries around the [suspicious PCAP](https://storage.googleapis.com/hhc22_player_assets/suspicious.pcap). Get hints for this challenge by typing `hint` in the upper panel of the terminal.

??? quote "Sparkle Redberry"
    Hey there! Iâ€™m Sparkle Redberry. We have a bit of an incident here.<br/>
    We were baking lembanh in preparation for the holidays.<br/>
    It started to smell a little funky, and then suddenly, a Snowrog crashed through the wall!<br/>
    We're trying to investigate what caused this, so we can make it go away.<br/>
    Have you used Wireshark to look at packet capture (PCAP) files before?<br/>
    I've got a PCAP you might find interesting.<br/>
    Once you've had a chance to look at it, please open this terminal and answer the questions in the top pane.<br/>
    Thanks for helping us get to the bottom of this!


## Hints

??? hint "Hints"
    Each question may have hints. If you want another hint from the elf, just type hint in the upper pane.

    1. Each question may have hints. If you want another hint from the elf, just type `hint` in the upper pane.
    2. If you need help with Wireshark filters you can [go here](https://www.cellstream.com/resources/2013-09-10-11-55-21/cellstream-public-documents/wireshark-related/83-wireshark-display-filter-cheat-sheet/file)
    3. If you need help with tshark filters, try [this cheat sheet](https://cheatography.com/mbwalker/cheat-sheets/tshark-wireshark-command-line/)
    4. Of course, SANS has lots of [cheat sheets](https://www.sans.org/blog/the-ultimate-list-of-sans-cheat-sheets/) that can help
    5. And remember, you can use Wireshark filters in tshark.


## Solution

??? abstract "Welcome message"
    This all started when I clicked on a link in my email.<br/>
    Can you help me?

1. There are objects in the PCAP file that can be exported by Wireshark and/or Tshark. What type of objects can be exported from this PCAP?
File > Export Objects > HTTP reveals several files which can be exported (e.g., app.php, favicon.ico)
Answer: http

1. What is the file name of the largest file we can export?
See the information in the window from question 1
Answer: app.php

1. What packet number starts that app.php file?
See the information in the window from question 1
Answer: 687

1. What is the IP of the Apache server?
User `tcp.port == 80 || tcp.port == 443` to find HTTP traffic and determine the server's IP.
Answer: 192.185.57.242

1. What file is saved to the infected host?
Export the HTTP objects and look in `app(1).php` on line 68 where it says `saveAs(blob1, 'Ref_Sept24-2020.zip');`
Answer: Ref_Sept24-2020.zip

1. Attackers used bad TLS certificates in this traffic. Which countries were they registered to? Submit the names of the countries in alphabetical order separated by a commas (Ex: Norway, South Korea).
Search for `tls.handshake.type == 11` and find the Certificate entries. In the subject fields you'll find country name codes (e.g., US, IL, SS). We need to provide countries for the malicious certificates though, so we can ignore the Microsoft entries. There are 2 entries that stand out:
- heardbellith.Icanwepeh.nagoya (IL)
- psprponoust.aquarelle (SS)

Answer: Israel, South Sudan

7. Is the host infected (Yes/No)?
Looking at the host the certificates were retrieved from we find `62.98.109.30` for South Sudan and `151.236.210.181` for Israel as the server IPs. Our host `10.9.24.101` can be seen communicating with both of them.

To confirm: we can confirm this by opening the `app(1).php` file as `app.html` in a web browser so it downloads the malicious `Ref_Sept24-2020.zip` zip file (banking trojan per VT) through the embedded JavaScript and inspecting the `.scr` screensaver file inside it.


!!! done "Answer"
    See the solution outline above


## Response

!!! quote "Sparkle Redberry"
    You got it - wonderful!<br/>
    So hey, when you're looking at the next terminal, remember you have multiple filetypes and tools you can utilize.<br/>
    Conveniently for us, we can use programs already installed on every Windows computer.<br/>
    So if you brought your own Windows machine, you can save the files to it and use whatever method is your favorite.<br/>
    Oh yeah! If you wanna learn more, or get stuck, I hear [Eric Pursley's talk](https://youtu.be/5NZeHYPMXAE) is about this very topic.
