---
icon: material/table-network
---

# Suricata Regatta

**Difficulty**: :fontawesome-solid-star::fontawesome-solid-star::fontawesome-solid-star::fontawesome-regular-star::fontawesome-regular-star:<br/>
**Direct link**: [suricata terminal](https://hhc22-wetty.kringlecon.com/?&challenge=suricata&id=a541998b-e466-4aca-91e7-26ae2f9ab78b)



## Objective

!!! question "Request"
    Help detect this kind of malicious activity in the future by writing some Suricata rules. Work with Dusty Giftwrap in the Tolkien Ring to get some hints.

??? quote "Fitzy Shortstack"
    Hm?.. Hello...<br/>
    Sorry, I don't mean to be uncharaceristically short with you.<br/>
    There's just this abominable Snowrog here, and I'm trying to comprehend Suricata to stop it from getting into the kitchen.<br/>
    I believe that if I can phrase these Suricata incantations correctly, they'll create a spell that will generate warnings.<br/>
    And hopefully those warnings will scare off the Snowrog!<br/>
    Only... I'm quite baffled. Maybe you can give it a go?


## Hints

??? hint "The Tome of Suricata Rules"
    [This](https://suricata.readthedocs.io/en/suricata-6.0.0/rules/intro.html) is the official source for Suricata rule creation!


## Solution

??? abstract "Welcome message"
    Use your investigative analysis skills and the `suspicious.pcap` file to help develop Suricata rules for the elves!<br/>
    There's a short list of rules started in `suricata.rules` in your home directory.<br/>
    First off, the STINC (Santa's Team of Intelligent Naughty Catchers) has a lead for us.<br/>
    They have some Dridex indicators of compromise to check out.<br/>
    First, please create a Suricata rule to catch DNS lookups for `adv.epostoday.uk`.<br/>
    Whenever there's a match, the alert message (msg) should read `Known bad DNS lookup, possible Dridex infection.`<br/>
    Add your rule to `suricata.rules`<br/>
    Once you think you have it right, run `./rule_checker` to see how you've done!<br/>
    As you get rules correct, rule_checker will ask for more to be added.<br/>
    If you want to start fresh, you can `exit` the terminal and start again or `cp suricata.rules.backup suricata.rules`<br/>
    Good luck, and thanks for helping save the North Pole!

1. Using the documentation at https://suricata.readthedocs.io/en/suricata-6.0.0/rules/intro.html we can write a rule that checks for DNS lookups to `adv.epostoday.uk`.

Answer: `alert dns any any -> any any (msg:"Known bad DNS lookup, possible Dridex infection."; dns.query; content:"adv.epostoday.uk"; nocase;sid:1000;)`

2. Develop a Suricata rule that alerts whenever the infected IP address 192.185.57.242 communicates with internal systems. When there's a match, the message (msg) should read `Investigate suspicious connections, possible Dridex infection`

Answer: `alert http any any <> 192.185.57.242 any (msg:"Investigate suspicious connections, possible Dridex infection"; flow:established; sid:1001;)`

3. We heard that some naughty actors are using TLS certificates with a specific CN. Develop a Suricata rule to match and alert on an SSL certificate for `heardbellith.Icanwepeh.nagoya`. When your rule matches, the message (msg) should read `Investigate bad certificates, possible Dridex infection`

Answer: `alert tls any any <> any any (msg:"Investigate bad certificates, possible Dridex infection"; tls.cert_subject; content:"CN=heardbellith.Icanwepeh.nagoya"; sid:1002;)`

4. OK, one more to rule them all and in the darkness find them. Let's watch for one line from the JavaScript: `let byteCharacters = atob`. Oh, and that string might be GZip compressed - I hope that's OK! Just in case they try this again, please alert on that HTTP data with `message Suspicious JavaScript function, possible Dridex infection`

Answer: `alert http any any <> any any (msg:"message Suspicious JavaScript function, possible Dridex infection"; http.response_body; content:"let byteCharacters = atob"; sid:1003;)`

!!! done "Answer"
    See the solution outline above


## Response

!!! quote "Fitzy Shortstack"
    Woo hoo - you wielded Suricata magnificently! Thank you!<br/>
    Now to shout the final warning of power to the Snowrog...<br/>
    YOU...SHALL NOT...PASS!!!<br/>
