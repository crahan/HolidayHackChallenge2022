# Trufflehog Search

**Difficulty**: :fontawesome-solid-star::fontawesome-solid-star::fontawesome-regular-star::fontawesome-regular-star::fontawesome-regular-star:<br/>
**Direct link**: [aws_scripts git repo](https://haugfactory.com/asnowball/aws_scripts.git)


## Objective

!!! question "Request"
    Use Trufflehog to find secrets in a Git repo. Work with Jill Underpole in the Cloud Ring for hints. What's the name of the file that has AWS credentials?

??? quote "Gerty Snowburrow"
    Well now, look who's venturing down into the caves!<br/>
    And well, who might you be, exaclty?<br/>
    I'm Gerty Snowburrow, if you need to know.<br/>
    And, not that I should be telling you, but I'm trying to figure out what Alabaster Snowball's done this time.<br/>
    Word is, he committed some secrets to a [code repo](https://haugfactory.com/asnowball/aws_scripts.git).<br/>
    If you're feeling so inclined, you can try and find them for me.


## Hints

??? hint "Trufflehog Tool"
    You can search for secrets in a Git repo with `trufflehog git https://some.repo/here.git.


## Solution

Trufflehog will return several research for an AWS secret key in the `put_policy.py` file.

```shell
pip install trufflehog
trufflehog https://haugfactory.com/asnowball/aws_scripts.git
~~~~~~~~~~~~~~~~~~~~~
Reason: High Entropy
Date: 2022-09-07 16:53:32
Hash: 3476397f95da11a776d4118f1f9ae6c9d4afd0c9
Filepath: put_policy.py
Branch: origin/main
Commit: added

@@ -4,8 +4,8 @@ import json

 iam = boto3.client('iam',
     region_name='us-east-1',
-    aws_access_key_id=ACCESSKEYID,
-    aws_secret_access_key=SECRETACCESSKEY,
+    aws_access_key_id="AKIAAIDAYRANYAHGQOHD",
+    aws_secret_access_key="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",
 )
 # arn:aws:ec2:us-east-1:accountid:instance/*
 response = iam.put_user_policy(

~~~~~~~~~~~~~~~~~~~~~
```

!!! done "Answer"
    `put_policy.py`


## Response

!!! quote "Gerty Snowburrow"
    Say, you got it done, didn't you?<br/>
    Well now, you might just be able to tackle the other AWS terminal down here.<br/>
    It's a bit more involved, but you've got the credentials to get it started now.<br/>
    Before you try it, you should know the difference between managed and inline policies.<br/>
    Short version: inline policies apply to one identity (user, role, group), and managed policies can be attached to many identities.<br/>
    There are different AWS CLI commands to interact with each kind.<br/>
    Other than that, the important bit is to know a bit about cloud or IAM privilege escalation.<br/>
    Sometimes attackers find access to more resources by just trying things until something works.<br/>
    But if they have access to the iam service inside the AWS CLI, they might just be able to ask what access they have!
